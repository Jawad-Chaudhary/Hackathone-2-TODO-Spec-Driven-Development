# Default values for todo-app Helm chart
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Namespace configuration
namespace:
  name: todo-app
  create: true

# Backend configuration
backend:
  enabled: true
  name: todo-backend
  replicaCount: 2

  image:
    repository: todo-backend
    tag: latest
    pullPolicy: Never  # Use local image from Minikube

  service:
    type: ClusterIP
    port: 8000
    targetPort: 8000
    sessionAffinity: None

  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  probes:
    readiness:
      enabled: true
      path: /health
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 5
      successThreshold: 1
      failureThreshold: 3
    liveness:
      enabled: true
      path: /health
      initialDelaySeconds: 30
      periodSeconds: 30
      timeoutSeconds: 5
      successThreshold: 1
      failureThreshold: 3

  env:
    jwtAlgorithm: "HS256"
    accessTokenExpireMinutes: "30"
    pythonUnbuffered: "1"

  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000

# Frontend configuration
frontend:
  enabled: true
  name: todo-frontend
  replicaCount: 2

  image:
    repository: todo-frontend
    tag: latest
    pullPolicy: Never  # Use local image from Minikube

  service:
    type: LoadBalancer
    port: 3000
    targetPort: 3000
    sessionAffinity: ClientIP
    sessionAffinityConfig:
      clientIP:
        timeoutSeconds: 10800

  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "500m"

  probes:
    readiness:
      enabled: true
      path: /
      initialDelaySeconds: 15
      periodSeconds: 10
      timeoutSeconds: 5
      successThreshold: 1
      failureThreshold: 3
    liveness:
      enabled: true
      path: /
      initialDelaySeconds: 30
      periodSeconds: 30
      timeoutSeconds: 5
      successThreshold: 1
      failureThreshold: 3

  env:
    nodeEnv: "production"
    nodeOptions: "--max-old-space-size=4096"
    betterAuthUrl: "http://localhost:3000"
    nextPublicAppUrl: "http://localhost:3000"
    # Backend URL for internal cluster communication
    nextPublicApiUrl: "http://todo-backend-service:8000"
    # Backend URL for browser (external access)
    nextPublicBackendUrl: "http://localhost:8000"

  securityContext:
    runAsNonRoot: true
    runAsUser: 1001
    fsGroup: 1001

# Secrets configuration
# Updated with actual values from .env files
secrets:
  # Database connection string (Neon PostgreSQL)
  databaseUrl: "postgresql+asyncpg://neondb_owner:npg_TLiaPgCzh4M1@ep-withered-unit-ahfe6rhh-pooler.c-3.us-east-1.aws.neon.tech/neondb"

  # Gemini API Key (using Gemini 2.0 Flash instead of OpenAI)
  openaiApiKey: "AIzaSyAvYXhnkc2Be7KjU8kgpzLjx7n4ZfZFf2g"

  # JWT Secret for authentication (generated)
  jwtSecret: "sOJ3BhFMarKHChkKLD6LxweDeKnKW94jOFZ8pJKzfjQ="

  # Better Auth Secret (from existing .env)
  betterAuthSecret: "6TEOphPj1d9cxoDUyEWkXHvVRV+xYlvlGbLfNa52hL4wssmS3IhzNxnjpucYUzjH"

  # OpenAI Domain Key for ChatKit (using Gemini API key as fallback)
  openaiDomainKey: "AIzaSyAvYXhnkc2Be7KjU8kgpzLjx7n4ZfZFf2g"

# Labels to apply to all resources
labels:
  app: todo
  phase: phase4
