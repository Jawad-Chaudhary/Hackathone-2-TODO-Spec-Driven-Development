# Default values for todo-app Helm chart
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# IMPORTANT: This is an example file with placeholder values
# Copy this file to values.yaml and replace with your actual secrets

# Namespace configuration
namespace:
  name: todo-app
  create: true

# Backend configuration
backend:
  enabled: true
  name: todo-backend
  replicaCount: 2

  image:
    repository: todo-backend
    tag: latest
    pullPolicy: Never  # Use local image from Minikube

  service:
    type: ClusterIP
    port: 8000
    targetPort: 8000
    sessionAffinity: None

  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  probes:
    readiness:
      enabled: true
      path: /health
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 5
      successThreshold: 1
      failureThreshold: 3
    liveness:
      enabled: true
      path: /health
      initialDelaySeconds: 30
      periodSeconds: 30
      timeoutSeconds: 5
      successThreshold: 1
      failureThreshold: 3

  env:
    jwtAlgorithm: "HS256"
    accessTokenExpireMinutes: "30"
    pythonUnbuffered: "1"

  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000

# Frontend configuration
frontend:
  enabled: true
  name: todo-frontend
  replicaCount: 2

  image:
    repository: todo-frontend
    tag: latest
    pullPolicy: Never  # Use local image from Minikube

  service:
    type: LoadBalancer
    port: 3000
    targetPort: 3000
    sessionAffinity: ClientIP
    sessionAffinityConfig:
      clientIP:
        timeoutSeconds: 10800

  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "500m"

  probes:
    readiness:
      enabled: true
      path: /
      initialDelaySeconds: 15
      periodSeconds: 10
      timeoutSeconds: 5
      successThreshold: 1
      failureThreshold: 3
    liveness:
      enabled: true
      path: /
      initialDelaySeconds: 30
      periodSeconds: 30
      timeoutSeconds: 5
      successThreshold: 1
      failureThreshold: 3

  env:
    nodeEnv: "production"
    nodeOptions: "--max-old-space-size=4096"
    betterAuthUrl: "http://localhost:3000"
    nextPublicAppUrl: "http://localhost:3000"
    # Backend URL for internal cluster communication
    nextPublicApiUrl: "http://todo-backend-service:8000"
    # Backend URL for browser (external access)
    nextPublicBackendUrl: "http://localhost:8000"

  securityContext:
    runAsNonRoot: true
    runAsUser: 1001
    fsGroup: 1001

# Secrets configuration
# IMPORTANT: Replace these placeholder values with your actual secrets before deploying
secrets:
  # Database connection string (Neon PostgreSQL)
  # Format: postgresql+asyncpg://user:password@host/database
  databaseUrl: "REPLACE_WITH_YOUR_NEON_DATABASE_URL"

  # Gemini API Key (or OpenAI API Key)
  # Get from: https://aistudio.google.com/apikey
  openaiApiKey: "REPLACE_WITH_YOUR_GEMINI_API_KEY"

  # JWT Secret for authentication
  # Generate with: openssl rand -base64 32
  jwtSecret: "REPLACE_WITH_YOUR_JWT_SECRET"

  # Better Auth Secret
  # Generate with: openssl rand -base64 48
  betterAuthSecret: "REPLACE_WITH_YOUR_BETTER_AUTH_SECRET"

  # OpenAI Domain Key for ChatKit (can use same as Gemini API Key)
  openaiDomainKey: "REPLACE_WITH_YOUR_OPENAI_DOMAIN_KEY"

# Labels to apply to all resources
labels:
  app: todo
  phase: phase4
